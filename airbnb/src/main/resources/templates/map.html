<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>숙소 위치</title>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=73c152dc849ecf3dd527c50bd6054f4d&libraries=clusterer"></script>
</head>
<body>
<div id="map" style="width:100%;height:350px;"></div>

<script>
  // Kakao 지도 API가 로드되었는지 확인
  if (typeof kakao !== 'undefined') {
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(37.5665, 126.9780), // 지도의 중심좌표 (서울 시청)
          level: 3 // 지도의 확대 레벨
        };

    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    // 서버에서 데이터를 가져오기
    fetch('/api/positions')
    .then(response => {
      // 응답이 정상적인지 확인
      if (!response.ok) {
        throw new Error('Network response was not ok ' + response.statusText);
      }

      return response.json();
    })
    .then(data => {
      // 데이터가 제대로 들어오는지 확인
      console.log(data);
      data.forEach(room => {
        // 각 방의 경도와 위도를 이용하여 마커 생성
        var markerPosition = new kakao.maps.LatLng(room.latitude, room.longitude);

        var marker = new kakao.maps.Marker({
          position: markerPosition
        });

        // 마커가 지도 위에 표시되도록 설정
        marker.setMap(map);

        // 인포윈도우 생성
        var infowindow = new kakao.maps.InfoWindow({
          content: `<div style="padding:5px;">${room.hostroomName}</div>`
        });

        // 마커에 클릭 이벤트를 등록하여 인포윈도우 표시
        kakao.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map, marker);
        });
      });
    })
    .catch(error => {
      // Fetch 작업 중 문제가 발생했을 때의 처리
      console.error('There was a problem with the fetch operation:', error);
    });
  } else {
    console.error('Kakao Maps API is not loaded.');
  }
</script>
</body>
</html>
